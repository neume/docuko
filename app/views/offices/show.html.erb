<% breadcrumb :office, current_office %>
<div class="row">
  <div class="col-md-3">
    <div class="card mb-3">
      <div class="card-body">
        <div class="d-flex flex-column flex-shrink-0 p-0" style="width: 280px;">
          <ul class="nav nav-pills flex-column mb-auto">
            <li class="nav-item">
              <%= link_to [current_office], class: "nav-link link-dark #{'active' if params[:controller] == 'offices'}" do %>
                <i class="fa fa-circle me-1"></i>
                Workspace
              <% end %>
            </li>
            <li class='nav-item'>
              <%= link_to [:edit, current_office], class: 'nav-link link-dark' do %>
                <i class="fa fa-cog me-1"></i> Office Config
              <% end %>
            </li>
            <li class='nav-item'>
              <%= link_to '', class: 'nav-link link-dark' do %>
                <i class="fa fa-timeline me-1"></i> Activity
                <span class='badge bg-success'>Not implemented</span>
              <% end %>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>
  <div class="col-md-9">
    <div class="row mb-2">
      <div class="col-md-7"><%= paginate @data_models%></div>
      <div class="col-md-5">
        <% search_params = @params.merge({
            slug: current_office.slug
           })
        %>
        <%= form_tag office_path(search_params), method: :get, class: 'float-end' do %>
          <div class='input-group'>
            <%= search_field_tag :search, params[:search], class: 'form-control', placeholder: 'Search', aria: { label: 'Search instance' } %>
            <%= submit_tag 'Search', class: 'btn btn-sm btn-primary' %>
          </div>
        <% end %>
      </div>
    </div>
    <div class="row">
    <% @data_models.all.each do |model| %>
      <div class='col-12 mb-4'>
        <div class="card">
          <div class="card-body">
            <%= link_to office_data_model_instances_path(data_model_id: model.id, office_slug: current_office.slug), class: 'stretched-link' do %>
            <% end %>
            <div class="row mb-2">
              <div class="col-9">
                <a href="#" class="badge fs-sm text-nav bg-info text-decoration-none">Example Tag</a>
                <span class='text-dark ps-3 ms-3 border-start'>
                  <%= model.created_at.strftime('%b %-d, %Y') %>
                </span>
              </div>
              <div class='col-3 text-end'>
                <div class="dropdowm z-1">
                  <button type="button" class="btn btn-outline-secondary btn-sm" data-bs-toggle="dropdown" aria-expanded="" id='data_model-<%= model.id %>'>
                    Actions
                  </button>

                  <div class="dropdown-menu dropdown-menu-sm dropdown-menu-end" aria-labelledby='data_model-<%= model.id %>' style="">
                    <%= link_to office_data_model_instances_path(data_model_id: model.id, office_slug: current_office.slug), class: 'dropdown-item' do %>
                      Show List
                    <% end %>
                    <% if current_membership.admin? %>
                      <%= link_to [current_office, model], class: 'dropdown-item' do%>
                        Settings
                      <% end %>
                    <% end %>
                  </div>
                </div>
              </div>
            </div>
            <div class="row">
              <h4 class="card-title">
                <%= model.name %>
              </h4>

              <% if model.description.present? %>
                <p class='text-dark'><%= model.description %></p>
              <% end %>
            </div>

            <div class='row mb-3'>
              <div class='col-12'>
                <span class='text-dark me-2'>
                    <i class="fa fa-box pe-1"></i>
                    <%= model.instances.count %> Instances
                    <b>
                      <% new_instances_count = model.instances.where(created_at: Time.current.beginning_of_day..Time.current.end_of_day).count %>
                      <% if new_instances_count > 0 %>
                        <span class='badge bg-success rounded-pill'><%= new_instances_count %> New</span>
                      <% end %>
                    </b>
                </span>
                <span class='text-dark'>
                  <i class="fa fa-file-word pe-1"></i>
                  <%= model.documents.count %> Documents
                  <b>
                    <% new_instances_count = model.documents.where(created_at: Time.current.beginning_of_day..Time.current.end_of_day).count %>
                    <% if new_instances_count > 0 %>
                      <span class='badge bg-success rounded-pill'><%= new_instances_count %> New</span>
                    <% end %>
                  </b>
                </span>
              </div>
            </div>
            <hr/>
            <div class="row z-1">
              <div class="col-12">
                <div class="d-flex">
                  <%= link_to office_data_model_instances_path(data_model_id: model.id, office_slug: current_office.slug), class: 'btn btn-outline-success px-4 me-3 z-1' do %>
                    <i class="fa fa-list me-1"></i>
                    <span class="d-none d-xl-inline">List</span>
                  <% end %>
                  <%= link_to new_office_data_model_instance_path(model.id, office_slug: current_office.slug), class: 'btn btn-outline-info px-4 me-3 z-1' do %>
                    <i class="fa fa-circle-plus me-1"></i> Add
                  <% end %>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    <% end %>
    <%= paginate @data_models %>
    <div>
  <div>
</div>
